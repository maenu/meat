<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Meat</title>
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			html, body {
				width: 100%;
				height: 100%;
			}
			.code {
				display: block;
				box-sizing: border-box;
				width: 100%;
				height: 80%;
			}
		</style>
		<script type="text/javascript" src="node_modules/jquery/dist/jquery.js"></script>
		<script type="text/javascript" src="node_modules/ch.maenulabs.type/ch.maenulabs.type.js"></script>
		<script type="text/javascript" src="bin/parser.js"></script>
		<script type="text/javascript" src="src/main/js/meat/ast/node.js"></script>
		<script type="text/javascript" src="src/main/js/meat/ast/visitor.js"></script>
		<script type="text/javascript" src="src/main/js/meat/vm/model.js"></script>
		<script type="text/javascript" src="src/main/js/meat/compiler.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$('textarea').on('keydown', function (event) {
					if (event.keyCode === 9) {
						var start = this.selectionStart;
						var end = this.selectionEnd;
						var value = $(this).val();
						$(this).val(value.substring(0, start) + '\t' + value.substring(end));
						this.selectionStart = start + 1;
						this.selectionEnd = this.selectionStart;
						event.preventDefault();
					}
				});
				var compiler = new meat.compiler.Compiler();
				$('#source .code').on('keyup', function () {
					var source = $(this).val();
					var ast = parser.parse(source);
					console.log(ast);
					var compiled = compiler.compile(ast);
					console.log(compiled);
					var evaluated = eval('(' + compiled + ')()');
					console.log(evaluated);
				});
			});
		</script>
	</head>
	<body>
		<div id="source">
			<h2>
				Source
			</h2>
			<textarea class="code"></textarea>
		</div>
	</body>
</html>
